<!DOCTYPE html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Timetable Builder</title>

    <link rel="stylesheet" href="css/normalize.css" />
    <link rel="stylesheet" href="css/foundation.min.css" />
    <link rel="stylesheet" href="css/styles.css" />

    <script src="js/vendor/modernizr.js"></script>
  </head>
  <body>
    <div class="nav-div">
      <dl class="tabs dl-nav-tab" data-tab>
        <dd class="active"><a href="#module-finder">Module Finder</a></dd>
        <dd><a href="#timetable-builder">Timetable Builder</a></dd>
      </dl>
    </div>
    <div class="tabs-content">
      <div class="content active" id="module-finder">
        <div data-ex-role="exhibit-collection" data-ex-item-types="Module"></div>
        <div data-ex-role="exhibit-facet"
             data-ex-expression=".moduleType.label"
             data-ex-facet-label="Type"
             data-ex-scroll="false">
        </div>
        <div data-ex-role="exhibit-facet"
             data-ex-expression=".mc"
             data-ex-facet-label="MC"
             data-ex-sort-mode="value"
             data-ex-scroll="false">
        </div>
        <div data-ex-role="exhibit-facet"
             data-ex-expression=".level"
             data-ex-facet-label="Level"
             data-ex-sort-mode="value"
             data-ex-scroll="false">
        </div>
        <div data-ex-role="exhibit-view"
             data-ex-view-class="Exhibit.TabularView"
             data-ex-paginate="True"
             data-ex-show-toolbox="False"
             data-ex-label="Table"
             data-ex-border="0"
             data-ex-columns=".label, .name, .description, .mc, .exam, .department"
             data-ex-column-labels="Module Code, Module Name, Module Description, MC, Exam, Department"
             data-ex-column-formats="list, list, list, list, list, list">
        </div>
      </div>
      <div class="content" id="timetable-builder">
        Timetable Builder
      </div>
    </div>
    <script src="js/modinfo.js"></script>
    <script src="js/auxmodinfo.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
    <script src="js/vendor/lodash.min.js"></script>
    <script src="js/vendor/foundation.min.js"></script>
    <script src="js/vendor/exhibit3/exhibit-api.js?bundle=false&autoCreate=false"></script>
    <script>
      $(document).foundation();
      $(document).one("scriptsLoaded.exhibit", function() {
        var auxModulesArray = AUXMODULES.auxModules;
        var examDateStringsArray = MODULES.examDates;
        var departmentStringsArray = AUXMODULES.departments;
        var moduleCodeRegex = /^(\D+)(\d{4})\D*$/;
        var modulesArray = _.map(MODULES.modules, function(modArrayRep, idx) {
          var auxModule = auxModulesArray[idx];
          var moduleCode = modArrayRep[0];
          var level;
          var moduleCodeMatchArray;
          var moduleTypeArray = [];
          if (moduleCode === "PH2302 / GEK2039") {
            level = 2000;
            moduleTypeArray.push("GEM");
          } else {
            moduleCodeMatchArray = moduleCode.match(moduleCodeRegex);
            if (moduleCodeMatchArray === null) {
              console.log("Module Code \"" + moduleCode +
                "\" does not match regex!"
              );
              level = 0;
            } else {
              level = _.parseInt(moduleCodeMatchArray[2]);
              // subtract unneeded digits
              level -= level % 1000;
              // Inspect first part of module code
              if (moduleCodeMatchArray[1] === "SSA" ||
                  moduleCodeMatchArray[1] === "SSB" ||
                  moduleCodeMatchArray[1] === "SSD" ||
                  moduleCodeMatchArray[1] === "SSS" ||
                  moduleCodeMatchArray[1] === "SSU") {
                moduleTypeArray.push("Singapore Studies");
              } else if (moduleCodeMatchArray[1] === "GEK" ||
                  moduleCodeMatchArray[1] === "GEM") {
                moduleTypeArray.push("GEM");
              }
            }
          }
          return {
            type: "Module",
            label: moduleCode,
            name: modArrayRep[1],
            description: auxModule[0],
            mc: modArrayRep[2],
            level: level,
            moduleType: moduleTypeArray,
            exam: examDateStringsArray[modArrayRep[3]],
            department: departmentStringsArray[auxModule[1]]
          };
        });
        // add ModuleTypes
        modulesArray.push({
          type: "ModuleType",
          label: "Singapore Studies"
        });
        modulesArray.push({
          type: "ModuleType",
          label: "GEM"
        });
        window.database = Exhibit.Database.create();
        window.database.loadData({
          types: {
            Module: {
              pluralLabel: "Modules"
            },
          },
          properties: {
            mc: {
              valueType: "number"
            },
            level: {
              valueType: "number"
            },
            moduleType: {
              valueType: "item"
            }
          },
          items: modulesArray
        });
        window.exhibit = Exhibit.create();
        window.exhibit.configureFromDOM();
      });
    </script>
  </body>
</html>
